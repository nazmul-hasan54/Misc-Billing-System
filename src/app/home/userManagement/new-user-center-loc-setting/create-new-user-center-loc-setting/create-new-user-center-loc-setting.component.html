<div>

  <nb-card size="small">
    <nb-card-body>
      <form [formGroup]="newUserForm" (ngSubmit)="newUserForm.valid && onSave()">
        <div class="row m-1 p-1">
          <div class="col-sm-2">
            <label class="col-form-label">Role : <span>*</span></label>
          </div>

          <div class="col-sm-6">
            <nb-select fullWidth formControlName="roleId" [placeholder]="'--- Select Role ---'">
              <nb-option *ngFor="let item of roleData" [value]="item.id">{{item.roleName}}</nb-option>
            </nb-select>
            <div *ngIf="(submitted && newUserForm.get('roleId').hasError('required')) || (newUserForm.get('roleId').hasError('required') && newUserForm.get('roleId').touched)" class="text-danger" padding>
                <div>Please Select Role</div>
            </div>
          </div>
        </div>

        <div *ngIf="this.roleName=='Admin'"> 
          <div class="row m-1 p-1">
            <div class="col-sm-2">
              <label class="col-form-label">Database : <span>*</span></label>
            </div>
            <div class="col-sm-6">
              <nb-select multiple fullWidth formControlName="db" (selectedChange)="onSelect($event)">
                <nb-option *ngFor="let item of dbData" [value]="item.code">{{item.dbName}}</nb-option>
              </nb-select>
              <div *ngIf="(submitted && newUserForm.get('db').hasError('required')) || (newUserForm.get('db').hasError('required') && newUserForm.get('db').touched)" class="text-danger" padding>
                  <div>Please Select Database</div>
              </div>
            </div>
          </div>
          <div class="row m-1 p-1">
            <div class="col-sm-2">
              <label>Location Code :</label>
            </div>
            <div class="col-sm-6">
              <nb-select multiple fullWidth placeholder="" formControlName="location" (selectedChange)="locationChange($event)">
                <nb-option disabled selected>Select Location</nb-option>
                <nb-option *ngFor="let item of locationData" [value]="item.id">{{item.code}}</nb-option>
              </nb-select>
            </div>
          </div>
        </div>
        
        <div *ngIf="this.roleName!='Admin'"> 
          <div class="row m-1 p-1">
            <div class="col-sm-2">
              <label class="col-form-label">Database : <span>*</span></label>
            </div>
            <div class="col-sm-6">
              <nb-select multiple fullWidth formControlName="db" (selectedChange)="onSelect($event)">
                <nb-option *ngFor="let item of DBCenterList" [value]="item.code">{{item.dbName}}</nb-option>
              </nb-select>
              <div *ngIf="(submitted && newUserForm.get('db').hasError('required')) || (newUserForm.get('db').hasError('required') && newUserForm.get('db').touched)" class="text-danger" padding>
                  <div>Please Select Database</div>
              </div>
            </div>
          </div>
          <div class="row m-1 p-1">
            <div class="col-sm-2">
              <label>Location Code :</label>
            </div>
            <div class="col-sm-6">
              <nb-select multiple fullWidth placeholder="" formControlName="location" (selectedChange)="locationChange($event)">
                <nb-option disabled selected>Select Location</nb-option>
                <nb-option *ngFor="let item of locationData" [value]="item.id">{{item.code}}</nb-option>
              </nb-select>
            </div>
          </div>
        </div>

        <div class="row m-1 p-1">
          <div class="col-sm-2">
            <label class="col-form-label">User Name : <span>*</span></label>
          </div>
          <div class="col-sm-6">
            <input type="text" class="form-control" fullWidth nbInput placeholder="Enter User Name"
              formControlName="userName" [readOnly]="isReadOnly" (keypress)="space($event)" [ngModel]="userName"
              (ngModelChange)="ConvertToLower($event)"
              [ngClass]="{'danger': (newUserForm.get('userName').touched || submit ) && newUserForm.get('userName').errors }" autocomplete="off">
            <!-- <span status="danger" *ngIf="hasError('userName','required') && submit"><small>Name is Required</small> !</span>
          <small status="danger" >Name is Required!! -->
            <!-- </small> -->
            <div *ngIf="(submitted && newUserForm.get('userName').hasError('required')) || (newUserForm.get('userName').hasError('required') && newUserForm.get('userName').touched)" class="text-danger" padding>
              <div>Please Enter User Name</div>
          </div>
          </div>
        </div>

        <div class="row m-1 p-1">
          <div class="col-sm-2">
            <label class="col-form-label">Password : <span>*</span></label>
          </div>

          <div class="col-sm-6">
            <input fullWidth nbInput formControlName="userPassword" type="password" class="form-control"
              placeholder="Enter Password" autocomplete="off">
              <div *ngIf="(submitted  &&  newUserForm.get('userPassword').hasError('required'))  || ( newUserForm.get('userPassword').hasError('required') && newUserForm.get('userPassword').touched)" class="text-danger" padding>
                <div>Please Enter Password</div>
            </div>
          </div>
        </div>

        <div class="row m-1 p-1">
          <div class="col-sm-2"></div>
          <div class="col-sm-6">
            <button class="col-sm-3 mx-1" nbButton status="primary" type="submit">Save</button>
            <button class="col-sm-3 mx-1" nbButton (click)="refresh()">Refresh</button>
          </div>
        </div>
      </form>
    </nb-card-body>
  </nb-card>

</div>

<!-- Datatable area -->
<div>

  <nb-card>

    <nb-card-body>

      <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
          <div class="col-lg-12">
            <div class="ibox">
              <div class="ibox-content">
                <div class="table-responsive">
                  <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger"
                    class="table table-striped table-bordered table-hover dataTables-example">
                    <thead>
                      <tr>
                      <tr>
                        <th scope="col">SL</th>
                        <th scope="col">User Name</th>
                        <th scope="col">Role</th>
                        <th scope="col">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of usersList; let i = index">
                        <th scope="row"> {{i + 1}} </th>
                        <td>{{item.value}}</td>
                        <td>{{item.roleName}}</td>
                        <td>
                          <i class="fas fa-edit fa-1x p-2 bg-primary text-white rounded"
                            (click)="getUserByLocationCenterbyIdForEdit(item.key)"></i>
                          &nbsp;
                          <i class="fa fa-trash fa-1x p-2 bg-danger text-white rounded"
                            (click)="deleteNewUser(item.key)"></i>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>

</div>
